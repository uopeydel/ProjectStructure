app.factory("authService",["$http","$q","localStorageService",function(n,t,i){var e="localhost:/",u={},r={isAuth:!1,userName:"",useRefreshTokens:!0},o=function(t){return f(),n.post(e+"api/account/register",t).then(function(n){return n})},s=function(u,o){f();var s=t.defer(),h="grant_type=password&username="+u.userName+"&password="+u.password,c=null,l=null;return o!=undefined?(c=h+"&client_id="+o.client_id,l=h+"&client_id=3ae54600cd964454b4caf6f91ffe0c48",n.post(e+"oauth2/token",c,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(t){n.post(e+"oauth2/token",l,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(n){u.useRefreshTokens?i.set("authorizationData",{token:n.access_token,userName:u.userName,refreshToken:n.refresh_token,useRefreshTokens:!0}):i.set("authorizationData",{token:n.access_token,userName:u.userName,refreshToken:"",useRefreshTokens:!1});r.isAuth=!0;r.userName=u.userName;r.useRefreshTokens=u.useRefreshTokens;s.resolve(t)}).error(function(n){f();s.reject(n)})}).error(function(n){f();s.reject(n)})):(h=h+"&client_id=3ae54600cd964454b4caf6f91ffe0c48",n.post(e+"oauth2/token",h,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(n){u.useRefreshTokens?i.set("authorizationData",{token:n.access_token,userName:u.userName,refreshToken:n.refresh_token,useRefreshTokens:!0}):i.set("authorizationData",{token:n.access_token,userName:u.userName,refreshToken:"",useRefreshTokens:!1});r.isAuth=!0;r.userName=u.userName;r.useRefreshTokens=u.useRefreshTokens;s.resolve(n)}).error(function(n){f();s.reject(n)})),s.promise},f=function(){i.remove("authorizationData");r.isAuth=!1;r.userName="";r.useRefreshTokens=!0},h=function(){var n=i.get("authorizationData");n&&(r.isAuth=!0,r.userName=n.userName,r.useRefreshTokens=n.useRefreshTokens)},c=function(){var r=t.defer(),u=i.get("authorizationData"),o;return u&&u.useRefreshTokens&&(o="grant_type=refresh_token&refresh_token="+u.refreshToken+"&client_id="+ngAuthSettings.clientId,i.remove("authorizationData"),n.post(e+"oauth2/token",o,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(n){i.set("authorizationData",{token:n.access_token,userName:n.userName,refreshToken:n.refresh_token,useRefreshTokens:!0});r.resolve(n)}).error(function(n){f();r.reject(n)})),r.promise};return u.saveRegistration=o,u.login=s,u.logOut=f,u.fillAuthData=h,u.authentication=r,u.refreshToken=c,u}]);app.factory("ordersService",["$http",function(n){var i="https://lkresserver.on.lk/",t={},r=function(){return n.get(i+"api/protected").then(function(n){return n})};return t.getOrders=r,t}]);app.factory("authInterceptorService",["$q","$location","localStorageService","$injector",function(n,t,i,r){var u={},e=function(n){n.headers=n.headers||{};var t=i.get("authorizationData");return t&&(n.url.split("/")[2]==="lkauthserver.on.lk"||(n.headers.Authorization="Bearer "+t.token)),n},o=function(t){var r=i.get("authorizationData");return t.status===401&&r!==null&&f({refresh_token:r.refreshToken,grant_type:"refresh_token",client_id:"3ae54600cd964454b4caf6f91ffe0c48"}).then(function(){location.reload(!0)}),n.reject(t)},f=function(t){var f=i.get("authorizationData"),u=n.defer(),e=r.get("$http");return e({method:"POST",url:"https://lkauthserver.on.lk/oauth2/token",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:t,transformRequest:function(n){var t=[];for(var i in n)t.push(encodeURIComponent(i)+"="+encodeURIComponent(n[i]));return t.join("&")}}).success(function(n){i.set("authorizationData",{token:n.access_token,userName:f.userName,refreshToken:n.refresh_token,useRefreshTokens:!0});u.resolve(n)}).error(function(n){u.reject(n)}),u.promise};return u.request=e,u.responseError=o,u.requestAccessToken=f,u}]);